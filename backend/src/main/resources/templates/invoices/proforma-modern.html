<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Proforma Invoice</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&amp;display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Unicode MS', 'Inter', sans-serif;
            font-size: 10pt;
            color: #1a202c;
            line-height: 1.5;
            padding: 50px;
            background: white;
        }

        /* Top Grid Layout */
        .top-section {
            display: table;
            width: 100%;
            margin-bottom: 50px;
        }

        .header-left {
            display: table-cell;
            width: 70%;
            vertical-align: top;
        }

        .header-right {
            display: table-cell;
            width: 30%;
            vertical-align: top;
            text-align: right;
        }

        .company-logo {
            max-width: 120px;
            max-height: 60px;
            margin-bottom: 15px;
            filter: grayscale(100%);
            transition: filter 0.3s;
        }

        .company-logo:hover {
            filter: grayscale(0%);
        }

        .company-name {
            font-size: 16pt;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            color: #111;
        }

        .company-details {
            font-size: 9pt;
            color: #718096;
            max-width: 300px;
        }

        .invoice-label {
            font-size: 24pt;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            letter-spacing: -1px;
            text-transform: uppercase;
        }

        .meta-info {
            font-size: 9pt;
            color: #4a5568;
        }

        .meta-item {
            margin-bottom: 4px;
        }

        .meta-label {
            font-weight: 600;
            color: #718096;
            margin-right: 8px;
        }

        /* Horizontal Divider */
        .divider {
            height: 1px;
            background: #e2e8f0;
            margin: 30px 0;
        }

        /* Billing/Shipping */
        .billing-grid {
            display: table;
            width: 100%;
            margin-bottom: 40px;
        }

        .address-box {
            display: table-cell;
            width: 50%;
            vertical-align: top;
        }

        .address-title {
            font-size: 8pt;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #a0aec0;
            margin-bottom: 12px;
        }

        .customer-name {
            font-size: 11pt;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .address-text {
            font-size: 9pt;
            color: #4a5568;
            line-height: 1.6;
        }

        /* Modern Table */
        .items-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            margin: 30px 0;
        }

        .items-table th {
            padding: 12px 15px;
            text-align: left;
            font-size: 8pt;
            font-weight: 700;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #edf2f7;
        }

        .items-table td {
            padding: 15px;
            background: #f7fafc;
            border-top: 1px solid transparent;
            border-bottom: 1px solid transparent;
            font-size: 9pt;
        }

        .items-table td:first-child {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
            border-left: 1px solid transparent;
        }

        .items-table td:last-child {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
            border-right: 1px solid transparent;
            text-align: right;
        }

        .items-table td.right {
            text-align: right;
        }

        .items-table td.center {
            text-align: center;
        }

        .product-name {
            font-weight: 600;
            color: #2d3748;
        }

        .product-desc {
            font-size: 8pt;
            color: #718096;
            margin-top: 4px;
        }

        /* Totals */
        .summary-section {
            display: block;
            margin-top: 30px;
        }

        .totals-card-wrapper {
            float: right;
            width: 300px;
        }

        .totals-card {
            width: 100%;
            padding: 20px;
            background: #2d3748;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .total-row {
            display: table;
            width: 100%;
            margin-bottom: 12px;
            font-size: 9pt;
        }

        .total-label {
            display: table-cell;
            text-align: left;
            color: #a0aec0;
        }

        .total-value {
            display: table-cell;
            text-align: right;
        }

        .grand-total-row {
            margin-bottom: 0;
            padding-top: 12px;
            border-top: 1px solid #4a5568;
            font-size: 12pt;
            font-weight: 700;
        }

        .total-label {
            color: #a0aec0;
        }

        /* Footer Info */
        .footer-grid {
            display: table;
            width: 100%;
            margin-top: 50px;
        }

        .footer-box {
            display: table-cell;
            width: 50%;
            vertical-align: top;
        }

        .footer-box:first-child {
            padding-right: 20px;
        }

        .footer-title {
            font-size: 8pt;
            font-weight: 700;
            text-transform: uppercase;
            color: #a0aec0;
            margin-bottom: 10px;
        }

        .footer-content {
            font-size: 8pt;
            color: #718096;
            line-height: 1.6;
        }

        .signature-box {
            margin-top: 60px;
            text-align: right;
        }

        .signature-line {
            display: inline-block;
            width: 200px;
            border-top: 2px solid #2d3748;
            padding-top: 10px;
            font-weight: 700;
            font-size: 9pt;
        }

        .signature-image {
            max-width: 120px;
            max-height: 60px;
            margin-bottom: 10px;
        }

        @media print {
            body {
                padding: 20px;
            }

            .totals-card {
                background: #2d3748 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .items-table td {
                background: #f7fafc !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>

<body>
    <div class="top-section">
        <div class="header-left">
            <img th:if="${organization.invoiceConfig != null and organization.invoiceConfig.logoUrl != null and !organization.invoiceConfig.logoUrl.isEmpty()}"
                th:src="${organization.invoiceConfig.logoUrl}" class="company-logo" alt="Logo" />

            <div class="company-name"
                th:text="${organization.invoiceConfig != null and organization.invoiceConfig.companyName != null and !organization.invoiceConfig.companyName.isEmpty() ? organization.invoiceConfig.companyName : (organization.displayName != null ? organization.displayName : organization.organizationName)}">
                Company Name
            </div>

            <div class="company-details">
                <div th:if="${organization.invoiceConfig != null and organization.invoiceConfig.companyAddress != null}"
                    th:utext="${#strings.replace(organization.invoiceConfig.companyAddress, '&#10;', '&lt;br/&gt;')}">
                    Address
                </div>
                <div th:if="${organization.invoiceConfig != null and organization.invoiceConfig.gstNumber != null and !organization.invoiceConfig.gstNumber.isEmpty()}"
                    style="margin-top: 5px;">
                    GST: <span th:text="${organization.invoiceConfig.gstNumber}">-</span>
                </div>
            </div>
        </div>

        <div class="header-right">
            <h1 class="invoice-label" th:text="${isProforma ? 'PROFORMA' : 'QUOTATION'}">PROFORMA</h1>
            <div class="meta-info">
                <div class="meta-item"><span class="meta-label">NO:</span> <span
                        th:text="${proposal.proposalNumber}">#123</span></div>
                <div class="meta-item"><span class="meta-label">DATE:</span> <span
                        th:text="${#temporals.format(proposal.createdAt, 'dd.MM.yyyy')}">01.01.2024</span></div>
                <div class="meta-item"><span class="meta-label">EXPIRES:</span> <span
                        th:text="${#temporals.format(proposal.validUntil, 'dd.MM.yyyy')}">01.02.2024</span></div>
            </div>
        </div>
    </div>

    <div class="divider"></div>

    <div class="billing-grid">
        <div class="address-box">
            <div class="address-title">Billed To</div>
            <div class="customer-name" th:if="${proposal.companyName != null and !proposal.companyName.isEmpty()}"
                th:text="${proposal.companyName}">Company Name</div>
            <div class="address-text" th:if="${proposal.billingAddress != null}">
                <div th:text="${proposal.billingAddress.street}">Street</div>
                <div>
                    <span th:text="${proposal.billingAddress.city}">City</span>,
                    <span th:text="${proposal.billingAddress.state}">State</span>
                    <span th:text="${proposal.billingAddress.postalCode}">Code</span>
                </div>
                <div th:text="${proposal.billingAddress.country}">Country</div>
            </div>
            <div class="address-text" th:if="${proposal.gstNumber != null and !proposal.gstNumber.isEmpty()}">
                <strong>GSTIN:</strong> <span th:text="${proposal.gstNumber}">-</span>
            </div>
            <div class="address-text" style="margin-top: 8px;">
                <div th:if="${proposal.customerEmail != null and !proposal.customerEmail.isEmpty()}">
                    <strong>Email:</strong> <span th:text="${proposal.customerEmail}">-</span>
                </div>
                <div th:if="${proposal.customerPhone != null and !proposal.customerPhone.isEmpty()}">
                    <strong>Phone:</strong> <span th:text="${proposal.customerPhone}">-</span>
                </div>
            </div>
        </div>

        <div class="address-box">
            <div class="address-title">Shipped To</div>
            <div class="customer-name" th:if="${proposal.companyName != null and !proposal.companyName.isEmpty()}"
                th:text="${proposal.companyName}">Company Name</div>
            <div class="address-text"
                th:with="address=${proposal.shippingAddress != null ? proposal.shippingAddress : proposal.billingAddress}">
                <div th:if="${address != null}">
                    <div th:text="${address.street}">Street</div>
                    <div>
                        <span th:text="${address.city}">City</span>,
                        <span th:text="${address.state}">State</span>
                        <span th:text="${address.postalCode}">Code</span>
                    </div>
                    <div th:text="${address.country}">Country</div>
                </div>
            </div>
        </div>
    </div>

    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 55%;">Description</th>
                <th class="center" style="width: 10%;">Qty</th>
                <th class="right" style="width: 15%;">Price</th>
                <th class="right" style="width: 20%;">Total</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="item : ${proposal.lineItems}">
                <td>
                    <div class="product-name" th:text="${item.productName}">Product</div>
                    <div class="product-desc" th:if="${item.description != null}" th:text="${item.description}">Desc
                    </div>
                </td>
                <td class="center" th:text="${item.quantity}">1</td>
                <td class="right" th:text="${#numbers.formatDecimal(item.unitPrice, 1, 'COMMA', 2, 'POINT')}">100.00
                </td>
                <td class="right" th:text="${#numbers.formatDecimal(item.lineSubtotal, 1, 'COMMA', 2, 'POINT')}">100.00
                </td>
            </tr>
        </tbody>
    </table>

    <div class="summary-section">
        <div class="totals-card-wrapper">
            <div class="totals-card">
                <div class="total-row">
                    <span class="total-label">SUBTOTAL</span>
                    <span class="total-value"
                        th:text="${#numbers.formatDecimal(proposal.subtotal, 1, 'COMMA', 2, 'POINT')}">0.00</span>
                </div>
                <div class="total-row" th:if="${proposal.discountAmount != null and proposal.discountAmount > 0}">
                    <span class="total-label">DISCOUNT</span>
                    <span class="total-value"
                        th:text="${#numbers.formatDecimal(proposal.discountAmount, 1, 'COMMA', 2, 'POINT')}">0.00</span>
                </div>
                <div class="total-row">
                    <span class="total-label">TAXABLE AMOUNT</span>
                    <span class="total-value"
                        th:text="${#numbers.formatDecimal(proposal.subtotal - (proposal.discountAmount != null ? proposal.discountAmount : 0), 1, 'COMMA', 2, 'POINT')}">0.00</span>
                </div>
                <div class="total-row" th:if="${proposal.taxAmount != null and proposal.taxAmount > 0}">
                    <span class="total-label">TOTAL GST</span>
                    <span class="total-value"
                        th:text="${#numbers.formatDecimal(proposal.taxAmount, 1, 'COMMA', 2, 'POINT')}">0.00</span>
                </div>
                <div class="total-row grand-total-row">
                    <span class="total-label" style="color: white;">TOTAL AMOUNT</span>
                    <span class="total-value"
                        th:text="${#numbers.formatDecimal(proposal.totalAmount, 1, 'COMMA', 2, 'POINT')}">0.00</span>
                </div>
                <div class="total-row"
                    style="background: rgba(255,255,255,0.1); margin-top: 10px; padding: 10px; border-radius: 8px;"
                    th:if="${proposal.paymentMilestones != null and !proposal.paymentMilestones.isEmpty() and proposal.currentMilestoneIndex != null and proposal.currentMilestoneIndex < proposal.paymentMilestones.size()}">
                    <span class="total-label" style="color: #63b3ed;">PAYABLE
                        ([(${proposal.paymentMilestones[proposal.currentMilestoneIndex].name})])</span>
                    <span class="total-value"
                        th:text="${#numbers.formatDecimal(proposal.totalAmount * proposal.paymentMilestones[proposal.currentMilestoneIndex].percentage / 100, 1, 'COMMA', 2, 'POINT')}">0.00</span>
                </div>
            </div>
        </div>
        <div style="clear: both;"></div>
    </div>

    <div class="footer-grid">
        <div class="footer-box">
            <div class="footer-title">Terms & Conditions</div>
            <div class="footer-content"
                th:utext="${#strings.replace(organization.invoiceConfig != null and organization.invoiceConfig.termsAndConditions != null ? organization.invoiceConfig.termsAndConditions : 'Standard terms apply', '&#10;', '&lt;br/&gt;')}">
                Terms
            </div>
        </div>
        <div class="footer-box"
            th:if="${organization.invoiceConfig != null and organization.invoiceConfig.bankName != null}">
            <div class="footer-title">Payment Info</div>
            <div class="footer-content">
                <strong>Bank:</strong> <span th:text="${organization.invoiceConfig.bankName}">-</span><br />
                <strong>A/C:</strong> <span th:text="${organization.invoiceConfig.accountNumber}">-</span><br />
                <strong>IFSC:</strong> <span th:text="${organization.invoiceConfig.ifscCode}">-</span>
            </div>
        </div>
    </div>

    <div class="signature-box">
        <img th:if="${organization.invoiceConfig != null and organization.invoiceConfig.authorizedSignatorySealUrl != null and !organization.invoiceConfig.authorizedSignatorySealUrl.isEmpty()}"
            th:src="${organization.invoiceConfig.authorizedSignatorySealUrl}" class="signature-image" alt="Signature" />
        <br />
        <div class="signature-line"
            th:text="${organization.invoiceConfig != null and organization.invoiceConfig.authorizedSignatoryLabel != null ? organization.invoiceConfig.authorizedSignatoryLabel : 'Authorized Signatory'}">
            Authorized Signatory
        </div>
    </div>
</body>

</html>