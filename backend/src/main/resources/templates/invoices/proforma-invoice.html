<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proforma Invoice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 10pt;
            color: #333;
            line-height: 1.4;
            padding: 40px;
            background: white;
        }

        /* Header Section */
        .header {
            display: table;
            width: 100%;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #003399;
        }

        .header-left {
            display: table-cell;
            width: 70%;
            vertical-align: top;
        }

        .header-right {
            display: table-cell;
            width: 30%;
            vertical-align: top;
            text-align: right;
        }

        .company-logo {
            max-width: 150px;
            max-height: 80px;
            margin-bottom: 10px;
            display: block;
        }

        .company-name {
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 5px;
            color: #003399;
        }

        .company-details {
            font-size: 9pt;
            line-height: 1.5;
            color: #666;
        }

        .invoice-title {
            font-size: 20pt;
            font-weight: bold;
            color: #003399;
            margin-bottom: 10px;
        }

        /* Invoice Metadata */
        .invoice-meta {
            display: table;
            width: 100%;
            margin: 20px 0;
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        .meta-row {
            display: table-row;
        }

        .meta-cell {
            display: table-cell;
            padding: 5px 10px;
            font-size: 10pt;
        }

        .meta-label {
            font-weight: bold;
            color: #495057;
            width: 120px;
        }

        .meta-value {
            color: #212529;
        }

        /* Addresses */
        .addresses {
            display: table;
            width: 100%;
            margin: 25px 0;
        }

        .address-column {
            display: table-cell;
            width: 48%;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: #f8f9fa;
            vertical-align: top;
        }

        .address-column:first-child {
            margin-right: 4%;
        }

        .address-title {
            font-weight: bold;
            font-size: 10pt;
            margin-bottom: 10px;
            color: #003399;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .address-content {
            font-size: 9pt;
            line-height: 1.6;
            color: #495057;
        }

        .customer-name {
            font-weight: bold;
            font-size: 10pt;
            color: #212529;
            margin-bottom: 5px;
        }

        /* Line Items Table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }

        .items-table thead {
            background: #003399;
            color: white;
        }

        .items-table th {
            padding: 12px 8px;
            text-align: left;
            font-size: 9pt;
            font-weight: bold;
            border: 1px solid #002266;
        }

        .items-table th.center {
            text-align: center;
        }

        .items-table th.right {
            text-align: right;
        }

        .items-table td {
            padding: 10px 8px;
            font-size: 9pt;
            border: 1px solid #dee2e6;
            vertical-align: top;
        }

        .items-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .items-table tbody tr:hover {
            background: #e9ecef;
        }

        .items-table .center {
            text-align: center;
        }

        .items-table .right {
            text-align: right;
        }

        .product-name {
            font-weight: bold;
            color: #212529;
            margin-bottom: 3px;
        }

        .product-description {
            font-size: 8pt;
            color: #6c757d;
            font-style: italic;
            margin-top: 4px;
            line-height: 1.4;
        }

        /* Totals Section */
        .totals-wrapper {
            display: table;
            width: 100%;
            margin-top: 25px;
        }

        .totals-left {
            display: table-cell;
            width: 55%;
            vertical-align: top;
        }

        .totals-right {
            display: table-cell;
            width: 45%;
            vertical-align: top;
        }

        .totals-table {
            width: 100%;
            border-collapse: collapse;
            margin-left: auto;
        }

        .totals-table td {
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            font-size: 10pt;
        }

        .totals-table .label {
            font-weight: bold;
            text-align: right;
            background: #f8f9fa;
            color: #495057;
            width: 60%;
        }

        .totals-table .amount {
            text-align: right;
            width: 40%;
            font-family: 'Courier New', monospace;
        }

        .totals-table .total-row {
            font-weight: bold;
            font-size: 11pt;
        }

        .totals-table .total-row .label,
        .totals-table .total-row .amount {
            /*background: #003399;*/
            /*border-color: #002266;*/
        }

        /* Footer Sections */
        .footer-sections {
            display: table;
            width: 100%;
            margin-top: 30px;
        }

        .footer-column {
            display: table-cell;
            width: 48%;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: #f8f9fa;
            vertical-align: top;
        }

        .footer-column:first-child {
            margin-right: 4%;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #003399;
            font-size: 10pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #003399;
            padding-bottom: 5px;
        }

        .section-content {
            font-size: 9pt;
            line-height: 1.6;
            color: #495057;
        }

        .bank-detail {
            margin-bottom: 5px;
        }

        .bank-detail strong {
            color: #212529;
            display: inline-block;
            width: 100px;
        }

        /* Signature */
        .signature-section {
            margin-top: 40px;
            text-align: right;
            page-break-inside: avoid;
        }

        .signature-image {
            max-width: 150px;
            max-height: 100px;
            margin-bottom: 10px;
        }

        .signature-label {
            font-weight: bold;
            font-size: 10pt;
            color: #003399;
            border-top: 2px solid #003399;
            padding-top: 5px;
            display: inline-block;
            min-width: 200px;
        }

        /* Footer Text */
        .footer-text {
            text-align: center;
            margin-top: 40px;
            font-size: 8pt;
            color: #6c757d;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            page-break-inside: avoid;
        }

        /* Print Styles */
        @page {
            size: A4;
            margin: 0;
        }

        @media print {
            body {
                padding: 20px;
            }

            .items-table tbody tr:hover {
                background: none !important;
            }
        }

        /* Utility Classes */
        .text-muted {
            color: #6c757d;
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mt-1 {
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <img th:if="${organization.invoiceConfig != null and organization.invoiceConfig.logoUrl != null and !organization.invoiceConfig.logoUrl.isEmpty()}"
                th:src="${organization.invoiceConfig.logoUrl}" class="company-logo" alt="Company Logo" />

            <div class="company-name"
                th:text="${organization.invoiceConfig != null and organization.invoiceConfig.companyName != null and !organization.invoiceConfig.companyName.isEmpty() ? organization.invoiceConfig.companyName : (organization.displayName != null ? organization.displayName : organization.organizationName)}">
                Company Name
            </div>

            <div class="company-details">
                <div th:if="${organization.invoiceConfig != null and organization.invoiceConfig.companyAddress != null}"
                    th:utext="${#strings.replace(organization.invoiceConfig.companyAddress, '&#10;', '&lt;br/&gt;')}">
                    Company Address<br />
                    City, State, Country
                </div>
                <div th:if="${organization.invoiceConfig != null and organization.invoiceConfig.gstNumber != null and !organization.invoiceConfig.gstNumber.isEmpty()}"
                    class="mt-1">
                    <strong>GST:</strong> <span th:text="${organization.invoiceConfig.gstNumber}">GST Number</span>
                </div>
                <div
                    th:if="${organization.invoiceConfig != null and organization.invoiceConfig.cinNumber != null and !organization.invoiceConfig.cinNumber.isEmpty()}">
                    <strong>CIN:</strong> <span th:text="${organization.invoiceConfig.cinNumber}">CIN Number</span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="invoice-title" th:text="${isProforma ? 'PROFORMA INVOICE' : 'QUOTATION'}">PROFORMA INVOICE</div>
        </div>
    </div>

    <!-- Invoice Metadata -->
    <div class="invoice-meta">
        <div class="meta-row">
            <div class="meta-cell meta-label">Reference No:</div>
            <div class="meta-cell meta-value" th:text="${proposal.proposalNumber}">PRO-001</div>
            <div class="meta-cell meta-label">Date:</div>
            <div class="meta-cell meta-value" th:text="${#temporals.format(proposal.createdAt, 'dd-MMM-yyyy')}">
                25-Feb-2024</div>
            <div class="meta-cell meta-label">Valid Until:</div>
            <div class="meta-cell meta-value" th:text="${#temporals.format(proposal.validUntil, 'dd-MMM-yyyy')}">
                25-Mar-2024</div>
        </div>
    </div>

    <!-- Bill To / Ship To -->
    <div class="addresses">
        <div class="address-column">
            <div class="address-title">Bill To</div>
            <div class="address-content">
                <div class="customer-name" th:text="${proposal.customerName}">Customer Name</div>
                <div th:if="${proposal.billingAddress != null}">
                    <div th:if="${proposal.billingAddress.street != null and !proposal.billingAddress.street.isEmpty()}"
                        th:text="${proposal.billingAddress.street}">Street Address</div>
                    <div>
                        <span
                            th:if="${proposal.billingAddress.city != null and !proposal.billingAddress.city.isEmpty()}"
                            th:text="${proposal.billingAddress.city}">City</span><span
                            th:if="${proposal.billingAddress.city != null and proposal.billingAddress.state != null}">,
                        </span><span
                            th:if="${proposal.billingAddress.state != null and !proposal.billingAddress.state.isEmpty()}"
                            th:text="${proposal.billingAddress.state}">State</span>
                    </div>
                    <div>
                        <span
                            th:if="${proposal.billingAddress.country != null and !proposal.billingAddress.country.isEmpty()}"
                            th:text="${proposal.billingAddress.country}">Country</span><span
                            th:if="${proposal.billingAddress.country != null and proposal.billingAddress.postalCode != null}">
                            - </span><span
                            th:if="${proposal.billingAddress.postalCode != null and !proposal.billingAddress.postalCode.isEmpty()}"
                            th:text="${proposal.billingAddress.postalCode}">Postal Code</span>
                    </div>
                </div>
                <div th:if="${proposal.customerEmail != null and !proposal.customerEmail.isEmpty()}" class="mt-1">
                    <strong>Email:</strong> <span th:text="${proposal.customerEmail}">email@example.com</span>
                </div>
                <div th:if="${proposal.customerPhone != null and !proposal.customerPhone.isEmpty()}">
                    <strong>Phone:</strong> <span th:text="${proposal.customerPhone}">+1234567890</span>
                </div>
            </div>
        </div>

        <div class="address-column">
            <div class="address-title">Ship To</div>
            <div class="address-content">
                <div class="customer-name" th:text="${proposal.customerName}">Customer Name</div>
                <div
                    th:with="address=${proposal.shippingAddress != null ? proposal.shippingAddress : proposal.billingAddress}">
                    <div th:if="${address != null and address.street != null and !address.street.isEmpty()}"
                        th:text="${address.street}">Street Address</div>
                    <div th:if="${address != null}">
                        <span th:if="${address.city != null and !address.city.isEmpty()}"
                            th:text="${address.city}">City</span><span
                            th:if="${address.city != null and address.state != null}">, </span><span
                            th:if="${address.state != null and !address.state.isEmpty()}"
                            th:text="${address.state}">State</span>
                    </div>
                    <div th:if="${address != null}">
                        <span th:if="${address.country != null and !address.country.isEmpty()}"
                            th:text="${address.country}">Country</span><span
                            th:if="${address.country != null and address.postalCode != null}"> - </span><span
                            th:if="${address.postalCode != null and !address.postalCode.isEmpty()}"
                            th:text="${address.postalCode}">Postal Code</span>
                    </div>
                </div>
            </div>
            <div th:if="${proposal.customerEmail != null and !proposal.customerEmail.isEmpty()}" class="mt-1">
                <strong>Email:</strong> <span th:text="${proposal.customerEmail}">email@example.com</span>
            </div>
            <div th:if="${proposal.customerPhone != null and !proposal.customerPhone.isEmpty()}">
                <strong>Phone:</strong> <span th:text="${proposal.customerPhone}">+1234567890</span>
            </div>
        </div>
    </div>

    <!-- Line Items Table -->
    <table class="items-table">
        <thead>
            <tr>
                <th class="center" style="width: 8%;">SR NO</th>
                <th style="width: 40%;">DESCRIPTION</th>
                <th class="center" style="width: 12%;">HSN/SAC</th>
                <th class="center" style="width: 10%;">QTY</th>
                <th class="right" style="width: 15%;">RATE (₹)</th>
                <th class="right" style="width: 15%;">AMOUNT (₹)</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="item, iterStat : ${proposal.lineItems}">
                <td class="center" th:text="${iterStat.count}">1</td>
                <td>
                    <div class="product-name" th:text="${item.productName}">Product Name</div>
                    <div th:if="${item.description != null and !item.description.isEmpty()}" class="product-description"
                        th:text="${item.description}">
                        Product description
                    </div>
                </td>
                <td class="center" th:text="${item.hsnCode != null and !item.hsnCode.isEmpty() ? item.hsnCode : '-'}">-
                </td>
                <td class="center">
                    <span th:text="${item.quantity}">1</span>
                    <span th:if="${item.unit != null and !item.unit.isEmpty()}"
                        th:text="' (' + ${item.unit} + ')'">(unit)</span>
                </td>
                <td class="right" th:text="${#numbers.formatDecimal(item.unitPrice, 1, 'COMMA', 2, 'POINT')}">1,000.00
                </td>
                <td class="right" th:text="${#numbers.formatDecimal(item.lineSubtotal, 1, 'COMMA', 2, 'POINT')}">
                    1,000.00</td>
            </tr>
        </tbody>
    </table>

    <!-- Totals Section -->
    <div class="totals-wrapper">
        <div class="totals-left">
            <!-- Left side can contain notes or additional information -->
        </div>
        <div class="totals-right">
            <table class="totals-table">
                <tr>
                    <td class="label">SUBTOTAL:</td>
                    <td class="amount"
                        th:text="'₹ ' + ${#numbers.formatDecimal(proposal.subtotal, 1, 'COMMA', 2, 'POINT')}">₹
                        10,000.00</td>
                </tr>
                <tr th:if="${proposal.discountAmount != null and proposal.discountAmount > 0}">
                    <td class="label">DISCOUNT:</td>
                    <td class="amount"
                        th:text="'- ₹ ' + ${#numbers.formatDecimal(proposal.discountAmount, 1, 'COMMA', 2, 'POINT')}">-
                        ₹ 500.00</td>
                </tr>
                <tr>
                    <td class="label">TAXABLE AMOUNT:</td>
                    <td class="amount"
                        th:text="'₹ ' + ${#numbers.formatDecimal(proposal.subtotal - (proposal.discountAmount != null ? proposal.discountAmount : 0), 1, 'COMMA', 2, 'POINT')}">
                        ₹ 10,000.00</td>
                </tr>
                <tr th:if="${proposal.taxAmount != null and proposal.taxAmount > 0}">
                    <td class="label">
                        TOTAL GST:
                        <span th:if="${proposal.gstType != null}" class="text-muted"
                            th:text="'[' + ${proposal.gstType} + ']'"></span>:
                    </td>
                    <td class="amount"
                        th:text="'₹ ' + ${#numbers.formatDecimal(proposal.taxAmount, 1, 'COMMA', 2, 'POINT')}">₹
                        1,800.00</td>
                </tr>
                <tr class="total-row">
                    <td class="label">TOTAL AMOUNT:</td>
                    <td class="amount"
                        th:text="'₹ ' + ${#numbers.formatDecimal(proposal.totalAmount, 1, 'COMMA', 2, 'POINT')}">₹
                        11,800.00</td>
                </tr>
                <tr class="total-row" style="color: #0047AB;"
                    th:if="${proposal.paymentMilestones != null and !proposal.paymentMilestones.isEmpty() and proposal.currentMilestoneIndex != null and proposal.currentMilestoneIndex < proposal.paymentMilestones.size()}">
                    <td class="label">PAYABLE VALUE</td>
                    <td class="amount"
                        th:text="'₹ ' + ${#numbers.formatDecimal(proposal.totalAmount * proposal.paymentMilestones[proposal.currentMilestoneIndex].percentage / 100, 1, 'COMMA', 2, 'POINT')}">
                        ₹ 0.00</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Footer Sections -->
    <div class="footer-sections">
        <div class="footer-column">
            <div class="section-title">Terms & Conditions</div>
            <div class="section-content"
                th:utext="${organization.invoiceConfig != null and organization.invoiceConfig.termsAndConditions != null ? #strings.replace(organization.invoiceConfig.termsAndConditions, '&#10;', '&lt;br/&gt;') : '1. Payment terms as agreed&lt;br/&gt;2. Validity: 30 days from date of issue'}">
                1. Payment terms as agreed<br />
                2. Validity: 30 days from date of issue
            </div>
        </div>

        <div class="footer-column">
            <div class="section-title">Bank Details</div>
            <div class="section-content"
                th:if="${isProforma and organization.invoiceConfig != null and organization.invoiceConfig.bankName != null}">
                <div class="bank-detail">
                    <strong>Bank Name:</strong>
                    <span th:text="${organization.invoiceConfig.bankName}">Bank Name</span>
                </div>
                <div class="bank-detail">
                    <strong>Account No:</strong>
                    <span th:text="${organization.invoiceConfig.accountNumber}">1234567890</span>
                </div>
                <div class="bank-detail">
                    <strong>IFSC Code:</strong>
                    <span th:text="${organization.invoiceConfig.ifscCode}">XXXX0000000</span>
                </div>
                <div class="bank-detail"
                    th:if="${organization.invoiceConfig.branchName != null and !organization.invoiceConfig.branchName.isEmpty()}">
                    <strong>Branch:</strong>
                    <span th:text="${organization.invoiceConfig.branchName}">Branch Name</span>
                </div>
            </div>
            <div class="section-content" th:if="${!isProforma}">
                Bank details are hidden for Quotation.
            </div>
            <div class="section-content"
                th:if="${isProforma and (organization.invoiceConfig == null or organization.invoiceConfig.bankName == null)}">
                Bank details not configured.
            </div>
        </div>
    </div>

    <!-- Signature Section -->
    <div class="signature-section">
        <div
            th:if="${organization.invoiceConfig != null and organization.invoiceConfig.authorizedSignatorySealUrl != null and !organization.invoiceConfig.authorizedSignatorySealUrl.isEmpty()}">
            <img th:src="${organization.invoiceConfig.authorizedSignatorySealUrl}" class="signature-image"
                alt="Authorized Signature" />
        </div>
        <div class="signature-label"
            th:text="${organization.invoiceConfig != null and organization.invoiceConfig.authorizedSignatoryLabel != null ? organization.invoiceConfig.authorizedSignatoryLabel : 'Authorized Signatory'}">
            Authorized Signatory
        </div>
    </div>

    <!-- Footer Text -->
    <div class="footer-text"
        th:text="${organization.invoiceConfig != null and organization.invoiceConfig.footerText != null ? organization.invoiceConfig.footerText : 'Thank you for your business'}">
        Thank you for your business
    </div>
</body>

</html>