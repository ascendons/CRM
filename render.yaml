# Render Blueprint - Deploy Both Frontend & Backend Together
# This file enables one-click deployment of the entire CRM application on Render

services:
  # ==========================================
  # Backend Service (Spring Boot)
  # ==========================================
  - type: web
    name: crm-backend
    env: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free  # Change to 'starter' for production
    region: oregon
    healthCheckPath: /api/v1/actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SPRING_DATA_MONGODB_URI
        sync: false  # Set manually in Render dashboard
      - key: JWT_SECRET
        generateValue: true  # Auto-generate secure secret
      - key: SERVER_PORT
        value: 8080

  # ==========================================
  # Frontend Service (Next.js)
  # ==========================================
  - type: web
    name: crm-frontend
    env: node
    plan: free  # Change to 'starter' for production
    region: oregon
    rootDir: frontend
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_API_URL
        sync: false  # Set manually after backend deploys
      - key: PORT
        value: 10000
    healthCheckPath: /

# ==========================================
# Database (MongoDB Atlas - External)
# ==========================================
# Note: Render doesn't offer managed MongoDB
# Use MongoDB Atlas (free tier available)
# Set MONGODB_URI manually in Render dashboard

# ==========================================
# Estimated Monthly Cost
# ==========================================
# Free Tier: $0 (limited hours, spins down after inactivity)
# Starter Plan: $14/service = $28/month total
# Standard Plan: $25/service = $50/month total
# Pro Plan: $85/service = $170/month total
